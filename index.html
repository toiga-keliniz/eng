<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tenses Quiz — (JSON)</title>
<style>
  body { background: #121212; color: #eee; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; text-align: center; padding: 10px; box-sizing: border-box; }
  .container { background: #1e1e1e; padding: 25px 30px; border-radius: 12px; width: 100%; max-width: 450px; box-shadow: 0 0 20px #000a; }
  .emoji { font-size: 48px; }
  .tense-name { font-weight: 700; font-size: 26px; margin-top: 10px; }
  .description { margin-top: 10px; color: #bbb; font-size: 15px; min-height: 40px; }
  .options { margin-top: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .option { background: #2a2a2a; padding: 12px; border-radius: 8px; cursor: pointer; user-select: none; transition: all 0.2s ease; font-size: 14px; display: flex; align-items: center; justify-content: center; min-height: 40px; border: 2px solid transparent; }
  .option:hover { background: #444; transform: translateY(-2px); }
  .option.selected { background: #007bff; color: white; font-weight: 700; border-color: #007bff; }
  .option.correct { background: #28a745; color: white; font-weight: bold; border-color: #fff; }
  .option.incorrect { background: #dc3545; color: white; opacity: 0.8; }
  button { margin-top: 25px; width: 100%; background: #007bff; color: white; font-size: 18px; border: none; padding: 14px 0; border-radius: 8px; cursor: pointer; transition: background 0.3s; }
  button:disabled { background: #555; cursor: not-allowed; }
  .result { margin-top: 20px; font-weight: 700; font-size: 18px; min-height: 28px; }
  .error-message { color: #f44336; font-weight: bold; }
</style>
</head>
<body>

  <div class="container" id="quiz-container">
    <div class="emoji" id="emoji">⏳</div>
    <div class="tense-name" id="tenseName">Загрузка...</div>
    <div class="description" id="description"></div>
    <div class="options" id="options"></div>
    <button id="checkBtn" disabled>Проверить</button>
    <div class="result" id="result"></div>
    <button id="nextBtn" style="display: none; margin-top: 15px;">Следующее</button>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Получаем все элементы со страницы
    const quizContainer = document.getElementById("quiz-container");
    const emojiEl = document.getElementById("emoji");
    const tenseNameEl = document.getElementById("tenseName");
    const descriptionEl = document.getElementById("description");
    const optionsEl = document.getElementById("options");
    const checkBtn = document.getElementById("checkBtn");
    const resultEl = document.getElementById("result");
    const nextBtn = document.getElementById("nextBtn");

    let allTenses = [];
    let currentTense = null;
    let selectedOptionDiv = null;
    let isAnswered = false;

    // --- Главная логика ---
    // 1. Загружаем данные из JSON
    fetch('tenses.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Не удалось загрузить файл tenses.json. Убедитесь, что он существует.');
            }
            return response.json();
        })
        .then(data => {
            allTenses = data;
            loadTense(); // 2. Начинаем викторину после успешной загрузки
        })
        .catch(error => {
            console.error(error);
            quizContainer.innerHTML = <div class="error-message">Ошибка: ${error.message}</div>;
        });

    function loadTense() {
        isAnswered = false;
        selectedOptionDiv = null;

        checkBtn.disabled = true;
        checkBtn.style.display = 'block';
        nextBtn.style.display = 'none';
        resultEl.textContent = "";
        optionsEl.innerHTML = "";

        currentTense = allTenses[Math.floor(Math.random() * allTenses.length)];

emojiEl.textContent = currentTense.emoji;
        tenseNameEl.textContent = currentTense.name;
        descriptionEl.textContent = currentTense.description;

        const options = generateOptions(currentTense.formula);

        options.forEach(formula => {
            const div = document.createElement("div");
            div.classList.add("option");
            div.textContent = formula;
            
            div.addEventListener('click', () => {
                if (isAnswered) return;
                
                const currentlySelected = optionsEl.querySelector('.selected');
                if (currentlySelected) {
                    currentlySelected.classList.remove('selected');
                }
                
                div.classList.add('selected');
                selectedOptionDiv = div;
                checkBtn.disabled = false;
            });
            optionsEl.appendChild(div);
        });
    }
    
    checkBtn.addEventListener('click', () => {
        if (!selectedOptionDiv) return;
        isAnswered = true;

        const isCorrect = selectedOptionDiv.textContent === currentTense.formula;

        if (isCorrect) {
            selectedOptionDiv.classList.remove('selected');
            selectedOptionDiv.classList.add('correct');
            resultEl.textContent = "✅ Правильно!";
            resultEl.style.color = "#28a745";
        } else {
            selectedOptionDiv.classList.remove('selected');
            selectedOptionDiv.classList.add('incorrect');
            resultEl.textContent = ❌ Неверно!;
            resultEl.style.color = "#dc3545";

            Array.from(optionsEl.children).find(opt => opt.textContent === currentTense.formula)?.classList.add('correct');
        }

        checkBtn.style.display = 'none';
        nextBtn.style.display = 'block';
    });

    nextBtn.addEventListener('click', loadTense);

    function generateOptions(correctFormula) {
        const otherFormulas = allTenses
            .map(t => t.formula)
            .filter(f => f !== correctFormula);
        shuffle(otherFormulas);
        const finalOptions = [correctFormula, ...otherFormulas.slice(0, 5)];
        return shuffle(finalOptions);
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
});
</script>
</body>
</html>
